clear;
%clc;
%xd,vt,h,alpha,theta,Q,pow  单位英尺和弧度
A1=[0   1   0   0   0   0   0   
0    -0.0196   -0.0000   -3.5776  -31.6936   -1.9016    0.2882
0         0         0 -387.8407  387.8407         0         0
0   -0.0004    0.0000   -0.6392    0.0000    0.9263   -0.0001
0         0         0         0         0    1.0000         0
0    0.0000   -0.0000   -1.0217         0   -0.8513         0
 0        0         0         0         0         0   -1.0000
];

%推力dt(0.0~1.0),升降舵de单位度
B1=[ 0  0
    0    0.0323
     0         0
     0   -0.0013
     0         0
     0   -0.0833
     34.0634   0
];

C=eye(7);
D=zeros(7,2);

C1=[1   0   0   0   0   0   0   
 0   0	1	0	0	0	0
];


% Q=diag([0  1 200 20 0 100 0 0]);
% R=diag([0.1 3]);
% [k,p,e]=lqr(A1,B1,Q,R);
% 
% [zz,pp,kk]=ss2zp(A1-B1*k,B1(:,1),C1(3,:),0);
% 
% AA=A1-b1*k;
% CC=C(1:2,:);
% DD=zeros(2,2);



%pp
%k
% 
% 
C_xd_h=C1(1:2,:);

A=[A1,zeros(7,2);-C_xd_h,zeros(2,2)];
B=[B1;zeros(2,2)];
C=[-C_xd_h,zeros(2,2)];
D=zeros(9,2);

%Q=diag([10  10 10 10 10 10 5 2 10]);
%R=diag([0.5 1.5]);

Q=diag([8 20 20 5 10 5 5 2 10]);
R=diag([0.5 1.5]);

[k,p,e]=lqr(A,B,Q,R);

eig(A-B*k)

Kp=k(:,1:7);
Ki=-k(:,8:9);


%  [zz,pp,kk]=ss2zp(A-B*k,B(:,1),C(1,:),0)

% 
% %Q=diag([50 0 0 0 0 0 0 0 5 50]);
% %R=diag([0.005 100]);
% 
% % Q=diag([50 5 5 5 5 5 0 5 5 50]);
% % R=diag([0.005 100]);
% % 
% % x0=[0 0 0 0 0 0 0 0 ]';
% % 
%  [k,p,e]=lqr(A,B,Q,R);
%  eig(A-B*k)
%  [zz,pp,kk]=ss2zp(A-B*k,B(:,1),C(1,:),0)
%  
%  KP=k(:,1:8);
%  KI=-k(:,9:10);
% 
% %KP(1:2,1:2)=[0 0 ;0 0];
% 
% %eig(A)

