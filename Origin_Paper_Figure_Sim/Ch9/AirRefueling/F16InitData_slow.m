% linearized model : x_dot = A_full * x + B_full * u
%                       y   = C * x
%   
%   ----State Variables --------                          
%      x = [ xd    ( ft )        - xPosition 
%            vt    ( ft/sec )    - velocity  
%            h     ( ft )        - altitude               
%            alpha ( rad )       - angle of attack        
%            theta ( rad )       - Euler angle            
%            Q     ( rad/sec )   - pitch rate             
%            pow                 - power      
%            yd    ( ft )        - yPosition
%            beta  ( rad )       - sideslip angle         
%            phi   ( rad )       - Euler angle            
%            P     ( rad/sec )   - roll rate              
%            R     ( rad/sec )   - yaw rate 
%          ];            
%                                                         
%   ---- Control Variables --------                       
%      u = [ thtl ( 0 ~ 1.0 )    - throttle setting       
%            el   ( deg )        - elevon deflection      
%            ail  ( deg )        - aileron deflection     
%            rdr  ( deg )        - rudder deflection 
%           ];   

       
        
    

rad2degree=180/pi;
Kc=diag([0.3048,0.3048,0.3048,rad2degree,rad2degree,rad2degree,1,0.3048,rad2degree,rad2degree,rad2degree,rad2degree]);

A_full=[
    0	1	0	0	0	0	0	0	0	0	0	0
0	-0.0196	0	-3.5776	-31.6936	-1.9016	0.2882	0	0	0	0	0
0	0	0	-387.8407	387.8407	0	0	0	0	0	0	0
0	-0.0004	0	-0.6392	0	0.9263	-0.0001	0	0	0	0	0
0	0	0	0	0	1	0	0	0	0	0	0
0	0	0	-1.0217	0	-0.8513	0	0	0	0	0	-0.0029
0	0	0	0	0	0	-1	0	0	0	0	0
0	0	0	0	0	0	0	0	387.8407	387.8407	0	0
0	0	0	0	0	0	0	0	-0.1802	0.08	0.1166	-0.9873
0	0	0	0	0	0	0	0	0	0	1	0.1164
0	0	0	0	0	0.0003	0	0	-14.8086	0	-2.0218	0.6833
0	0	0	0	0	0.0025	0	0	4.414	0	-0.0429	-0.2861
];




B_full=[
    0	0	0	0
0	0.0323	0	0
0	0	0	0
0	-0.0013	0	0
0	0	0	0
0	-0.0833	0	0
34.0634	0	0	0
0	0	0	0
0	0	0.0002	0.0005
0	0	0	0
0	0	-0.3305	0.0576
0	0	-0.014	-0.0292
];

C_xd_h_yd=[
    1	0	0	0	0	0	0	0	0	0	0	0
0	0	1	0	0	0	0	0	0	0	0	0
0	0	0	0	0	0	0	1	0	0	0	0
];





% Csta=[  0   0   0   0   0   0;
%         -0.1   0   0   0   0   0;
%         0   0   0   0   0   0;
%         0   0   -1/120   0   0   0;
%         0   0   0   0   0   0;
%         0   0   0   0   -1/0.3048   0;
%         0   0   0   0   0   0;
%         0   0   0   0   0   0;
%         0   -1/120   0   0   0   0;
%         0   0   0   0   0   0;
%         0   0   0   -1/0.3048   0   0;
%         0   0   0   0   0   -1/0.3048;
% ];

Csta=[  0   0   0   0   0   0;
        0   0   0   0   0   0;
        0   0   0   0   0   0;
        0   0   -1/120   0   0   0;
        0   0   0   0   0   0;
        0   0   0   0   -1/0.3048   0;
        0   0   0   0   0   0;
        0   0   0   0   0   0;
        0   -1/120   0   0   0   0;
        0   0   0   0   0   0;
        0   0   0   -1/0.3048   0   0;
        0   0   0   0   0   -1/0.3048;
];
 


alpha_e=0.11587;
I1=[cos(alpha_e) 0 -sin(alpha_e);
    0   1   0;
    sin(alpha_e) 0  cos(alpha_e)];
Cb_e=[I1,zeros(3,3);
    zeros(3,3),I1];
B_wTur=A_full*Csta*Cb_e;



C_xd_h_yd2m=0.3048*C_xd_h_yd;
C_xd_h_yd2m=[C_xd_h_yd2m(1,:);
            C_xd_h_yd2m(3,:);
            -C_xd_h_yd2m(2,:)
            ];
m2ft=1/0.3048;

X1_0=zeros(12,1);



trim_state=[
0
120
3000
0.11587
0
0
0
0
0
0
0
0
];

trim_thrust=0.17766;
trim_control=[-3.132
0
0
];



% Ki=[
% 1.968540757	0.790086351	0
% 0.203999419	-2.541375189	0
% 0	0	-94.73313871
% 0	0	32.02549657
% ];

Ki=[1.97872869	0.650510465	0
0.53113957	-8.078126048	0
0	0	-42.2907243
0	0	14.54285522
];

% Kp=[
% 8.647219669	15.08664973	2.427106798	-793.6145979	783.1584645	17.38787943	3.173892435	0	0	0	0	0
% 0.730725432	0.685370236	-5.746668131	1227.954047	-1541.083576	-102.8493592	0.000690745	0	0	0	0	0
% 0	0	0	0	0	0	0	-76.44449999	-2695.835932	-2786.448	-146.6741806	94.44928757
% 0	0	0	0	0	0	0	25.98078772	966.1936598	989.3645597	42.70014199	-97.4920165
% ];

Kp=[
    10.14682831	16.15679364	2.89336246	-887.2401337	883.246216	20.06038063	3.176803688	0	0	0	0	0
2.324662285	1.873586022	-29.86180443	4914.750847	-5757.534643	-221.8960369	0.000415588	0	0	0	0	0
0	0	0	0	0	0	0	-98.28284444	-3206.82647	-3299.932002	-157.3598426	102.3757698
0	0	0	0	0	0	0	33.8328263	1140.350767	1164.357296	46.25277445	-100.1256537
];

X1_0=[0 0 0 0 0 0 0 0 0 0 0 0]';

C_attitude=[0 0 0 1 0 0 0 0 0 0 0 0;
           0 0 0 0 0 0 0 0 1 0 0 0;
           0 0 0 0 0 0 0 0 0 1 0 0];